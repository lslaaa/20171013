!function(a){function b(){u=!0,0==p.allowMultiple?(a(".imgbox-wrap").remove(),a(".imgbox-bg-wrap").remove()):v+=2,s=h();var b=a(o).attr("title")||"";if(a('<div id="imgbox-wrap-'+t+'" class="imgbox-wrap"></div>').css({"z-index":v,padding:p.padding}).append('<img class="imgbox-img" id="imgbox-img-'+t+'" src="'+q.src+'" alt="'+b+'" />').appendTo("body"),a('<div id="imgbox-bg-'+t+'" class="imgbox-bg-wrap"><div class="imgbox-bg imgbox-bg-n"/><div class="imgbox-bg imgbox-bg-ne"/><div class="imgbox-bg imgbox-bg-e"/><div class="imgbox-bg imgbox-bg-se"/><div class="imgbox-bg imgbox-bg-s"/><div class="imgbox-bg imgbox-bg-sw"/><div class="imgbox-bg imgbox-bg-w"/><div class="imgbox-bg imgbox-bg-nw"/></div>').appendTo("body"),w=0,b.length>0&&(a('<div id="imgbox-tmp" class="imgbox-title" />').html(b).css("width",s.width).appendTo("body"),w=a("#imgbox-tmp").outerHeight(),s.height+=w,s.top-=w>y+x?y:.5*y,a("#imgbox-tmp").remove(),a("#imgbox-wrap-"+t).append('<div class="imgbox-title">'+b+"</div>")),p.speedIn>0){var e=j();r={top:e.top-p.padding,left:e.left-p.padding,width:e.width,height:e.height},a("#imgbox-wrap-"+t).css(r).show(),a("#imgbox-bg-"+t).css({top:r.top,left:r.left,width:r.width+2*p.padding,height:r.height+2*p.padding,"z-index":v-1}).show(),p.zoomOpacity&&(s.opacity=1),z.prop=0,a(z).animate({prop:1},{duration:p.speedIn,easing:p.easingIn,step:c,complete:d})}else a("#imgbox-img-"+t).css("height",s.height-w+"px"),a("#imgbox-wrap-"+t).css(s).fadeIn("normal",d),a("#imgbox-bg-"+t).css({top:s.top,left:s.left,width:s.width+2*p.padding,height:s.height+2*p.padding,"z-index":v-1}).fadeIn("normal")}function c(b){var c=Math.round(r.width+(s.width-r.width)*b),d=Math.round(r.height+(s.height-r.height)*b),e=Math.round(r.top+(s.top-r.top)*b),f=Math.round(r.left+(s.left-r.left)*b);if(a("#imgbox-wrap-"+t).css({width:c+"px",height:d+"px",top:e+"px",left:f+"px"}),a("#imgbox-bg-"+t).css({width:Math.round(c+2*p.padding)+"px",height:Math.round(d+2*p.padding)+"px",top:e+"px",left:f+"px"}),a("#imgbox-img-"+t).css("height",Math.round(d-100*(d-Math.min(r.height,s.height))/Math.max(r.height-s.height,s.height-r.height)*w/100)+"px"),"undefined"!=typeof s.opacity){var g=.3>b?.3:b;a("#imgbox-wrap-"+t).css("opacity",g)}}function d(){p.overlayShow&&p.hideOnOverlayClick&&a("#imgbox-overlay").bind("click",{elem:o,nr:t,opts:p,titleh:w},e),a("#imgbox-wrap-"+t).css("filter","").bind("click",{elem:o,nr:t,opts:p,titleh:w},e).append('<a href="javascript:;" class="imgbox-close"></a>').children(".imgbox-title").show(),a(".imgbox-wrap").css("height",a(".imgbox-wrap").height()),a(".imgbox-wrap").css("width",a(".imgbox-wrap").width()),u=!1}function e(b){b.stopPropagation(),"imgbox-close"==b.target.className||b.data.opts.hideOnOverlayClick&&"imgbox-overlay"==b.target.id||b.data.opts.hideOnContentClick&&"imgbox-img"==b.target.className&&(a(this).css("z-index")==v||1==a(".imgbox-img").length)?(o=b.data.elem,t=b.data.nr,p=b.data.opts,w=b.data.titleh,f()):a(this).css("z-index")<v&&(a(this).next(".imgbox-bg-wrap").css("z-index",++v),a(this).css("z-index",++v))}function f(){if(u)return!1;if(u=!0,a("#imgbox-wrap-"+t).children(".imgbox-close, .imgbox-title").remove(),p.speedOut>0){var b=j();r={top:b.top-p.padding,left:b.left-p.padding,width:b.width,height:b.height};var b=a("#imgbox-wrap-"+t).position();s={top:b.top,left:b.left,width:a("#imgbox-wrap-"+t).width(),height:a("#imgbox-wrap-"+t).height()},p.zoomOpacity&&(s.opacity=0),setTimeout(function(){a("#imgbox-wrap-"+t).css("z-index",90),a("#imgbox-bg-"+t).css("z-index",90)},.5*p.speedOut),z.prop=1,a(z).animate({prop:0},{duration:p.speedIn,easing:p.easingIn,step:c,complete:g})}else p.overlayShow?g():(a("#imgbox-bg-"+t).fadeOut("fast"),a("#imgbox-wrap-"+t).fadeOut("fast",g))}function g(){a("#imgbox-bg-"+t).stop().remove(),a("#imgbox-wrap-"+t).remove(),v=v>90?v-2:90,p.overlayShow&&a("#imgbox-overlay").unbind().stop().fadeOut(200),u=!1}function h(){var a=i(),b={width:q.width,height:q.height},c=2*(p.padding+x+y),d=2*(p.padding+x+y);if(p.autoScale&&(b.width>a[0]-c||b.height>a[1]-d)){var e=Math.min(Math.min(a[0]-c,b.width)/b.width,Math.min(a[1]-d,b.height)/b.height);b.width=Math.round(e*b.width),b.height=Math.round(e*b.height)}if("center"==p.alignment)b.top=a[3]+.5*(a[1]-b.height-2*p.padding),b.left=a[2]+.5*(a[0]-b.width-2*p.padding);else{var f=j();b.top=f.top-.5*(b.height-f.height)-p.padding,b.left=f.left-.5*(b.width-f.width)-p.padding,b.top=b.top>a[3]+y+x?b.top:a[3]+y+x,b.left=b.left>a[2]+y+x?b.left:a[2]+y+x,b.top=b.top>a[1]+a[3]-(b.height+d)?a[1]+a[3]-(b.height+(y+x+2*p.padding)):b.top,b.left=b.left>a[0]+a[2]-(b.width+c)?a[0]+a[2]-(b.width+(y+x+2*p.padding)):b.left}return 0==p.autoScale&&(b.top=b.top>a[3]+x+y?b.top:a[3]+x+y,b.left=b.left>a[2]+x+y?b.left:a[2]+x+y),b.top=parseInt(b.top),b.left=parseInt(b.left),b}function i(){return[a(window).width(),a(window).height(),a(document).scrollLeft(),a(document).scrollTop()]}function j(){var b=a(o).find("img").eq(0),c=b.offset();return c.top+=parseFloat(b.css("paddingTop")),c.left+=parseFloat(b.css("paddingLeft")),c.top+=parseFloat(b.css("border-top-width")),c.left+=parseFloat(b.css("border-left-width")),c.width=b.width(),c.height=b.height(),c}function k(){var b=j(o);a("#imgbox-loading").css(b).show()}function l(){a(q).unbind(),a("#imgbox-loading").hide()}function m(){l(),p.overlayShow&&a("#imgbox-overlay").unbind().stop().fadeOut(200)}function n(){a('<div id="imgbox-loading"><div></div></div><div id="imgbox-overlay"></div>').appendTo("body"),a("#imgbox-loading").click(m).find("div").css("opacity",.4)}a.fn.fixPNG=function(){return this.each(function(){var b=a(this).css("backgroundImage");b.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(b=RegExp.$1,a(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+("no-repeat"==a(this).css("backgroundRepeat")?"crop":"scale")+", src='"+b+"')"}).each(function(){var b=a(this).css("position");"absolute"!=b&&"relative"!=b&&a(this).css("position","relative")}))})};var o,p,q,r,s,t,u=!1,v=90,w=0,x=20,y=20,z=a.extend(a("<div/>")[0],{prop:0});a.fn.imgbox=function(b){return this.unbind("click.pb").bind("click.pb",function(){return a.imgbox(a(this),b),!1})},a.imgbox=function(c,d){return u?!1:(o=c,p=a.extend({},a.fn.imgbox.defaults,d),t=o[0].id,a("#imgbox-wrap-"+t).length?(f(),!1):(l(),p.overlayShow&&a("#imgbox-overlay").unbind().stop().hide().css({height:a(document).height(),opacity:p.overlayOpacity}).show(),q=new Image,q.src=a(o).attr("href"),void(0==q.complete?(k(),a(q).unbind().one("load",function(){l(),b()})):b())))},a.fn.imgbox.defaults={padding:10,alignment:"auto",allowMultiple:!0,autoScale:!0,speedIn:500,speedOut:500,easingIn:"swing",easingOut:"swing",zoomOpacity:!1,overlayShow:!1,overlayOpacity:.5,hideOnOverlayClick:!0,hideOnContentClick:!0},a(document).ready(function(){n()})}(jQuery);